{{define "content"}}

<div class="my-5 text-center">
    <h2>Challenges</h2>
</div>

{{ $user := .User }}
{{ $solves := .Solves }}
{{ range $cat, $chals := .Challenges }} {{ if or ($chals | is_visible_category) $user.IsAdmin }}
    <h3 class="text-center"> {{ $cat }} </h3>

    <div class="grid row mx-auto mb-5 ml-auto" data-masonry='{ "itemSelector": ".grid-item", "columnWidth": 300, "gutter": 10 ,"isFitWidth": true}'>
        {{ range $i, $chal :=  $chals }}
            {{ if or (not $chal.Hidden) $user.IsAdmin }}
            <div class="chall-box grid-item">
                {{ if not (index $solves $chal.Name) }}
                    <button class="btn {{ if $chal.Hidden }} chall-hidden {{ else }} challpreview {{ end }} w-100 h-100 " name="{{ $chal.ID }}" {{ if $chal.IsExtra }} {{ end }}>
                {{ else }}
                    <button class="btn w-100 h-100 challpreview" name="{{ $chal.ID }}">
                {{ end }}
                        {{ if $chal.IsExtra }}
                            <div class="animated-rainbow">EXTRA</div>
                        {{ end }}
                        <h4 class="chall-title"> {{ $chal.Name }} {{ if $chal.Hidden }}<i class="fa fa-eye-slash" aria-hidden="true"></i>{{ end }} </h4>
                        <div class="chall-footer">
                            <h5 class="chall-points">{{ $chal.Points }}pt</h5>
                            <h5 class="chall-difficulty">{{ $chal.Difficulty }}</h5>
                        </div>
                    </button>
            </div>
            {{ end }}
        {{ end }}
    </div>
{{ end }} {{ end }}


{{ range $cat, $chals := .Challenges }}
    {{ range $chal := $chals }}
        {{ if or (not $chal.Hidden) $user.IsAdmin }}
<div class="d-none {{ $chal.ID }} challtoggle position-fixed" style="width: 35%; top:50%; left:50%; transform: translate(-50%, -50%); border: 0px solid black; background-color: GhostWhite; border-radius:10px; color: DimGrey; box-shadow: 0px 0px 10px #888888;">
    <div class="text-center">
        <h1 class="mt-4"> {{ $chal.Name }} </h1>
        <h3> Solves: {{ $chal.Solves }} </h3>
        <h4> Points: {{ $chal.Points }} </h4>

        <div class="mt-5 mb-3 ml-3 mr-3" style="text-decoration: none;">
        {{ $rows := split "\n" $chal.Description }}
        {{ range $index, $row := $rows }}
            <h6 class="mb-0">{{ $row }}</h6>
        {{ end }}
        </div>

        {{ if $chal.Files }}
            </br>
            {{ $files := split "," $chal.Files }}
            {{ range $file := $files }}
                <h6>
                    <a href="{{ $file }}" style="color: grey; text-decoration: none;">
                        <i class="fa fa-download download_icon" aria-hidden="true"></i> {{ $file | split "/" | last }} </a>
                </h6>
            {{ end }}
        {{ end }}
        {{ if and $chal.Host $chal.Port }}
            <h6 class="my-3"> nc {{ $chal.Host }} {{ $chal.Port }} </h6>
        {{ else if $chal.Host }}
            <a href="{{ $chal.Host }}"><h6 class="my-3">{{ $chal.Host }}</h6></a>
        {{ end }}
        {{ if $chal.Hint1 }}
            <p class="mt-5 mb-3">&bull; {{ $chal.Hint1 }} </p>
        {{ end }}
        {{ if $chal.Hint2 }}
            <p class="my-3">&bull; {{ $chal.Hint2 }} </p>
        {{ end }}
        {{ if not (index $solves $chal.Name) }}
            <form class="mb-4" action="/submit" method="POST">
                <div class="input-group mt-5 mb-2 mx-auto" style="width: 90%">
                    <input type="hidden" name="challID" value="{{ $chal.ID }}">
                    <input type="text" class="form-control challenge-flag" placeholder="flag" name="flag">
                    <div class="input-group-append">
                        <button class="btn" type="submit" method="POST" style="background-color: silver">Submit</button>
                    </div>
                </div>
            </form>
        {{ else }}
            <h6 class="my-4"> Challenge already solved</h6>
        {{ end }}
        </div>
</div>
        {{ end }}
    {{ end }}
{{ end }}

<script>
    $(".chalpreview").click(function(e) {
        var modal = $("div." + e.currentTarget.name);
        modal.removeClass("d-none");
        var contents = modal.contents().find(".challenge-flag");
        if(contents.length > 0) {
            contents[0].focus();
        }
        e.preventDefault();
    });

    $(document).mouseup(function(e) {
        var container = $("div.challtoggle");

        if (!container.is(e.target) && container.has(e.target).length === 0) {
            container.addClass("d-none");
        }
    });
</script>

{{ end }}
